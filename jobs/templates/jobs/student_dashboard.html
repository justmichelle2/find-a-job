{% extends 'base.html' %}
{% load static %}

{% block title %}Student Dashboard - Campus Job Board{% endblock %}

{% block content %}
<div class="container my-5">
    <h1 class="mb-4"><i class="bi bi-person-circle"></i> Student Dashboard</h1>
    
    {% if user.verification_status != 'V' %}
    <div class="alert alert-warning mb-4">
        <h4 class="alert-heading"><i class="bi bi-exclamation-triangle"></i> Account Verification Required</h4>
        {% if user.verification_status == 'P' %}
            <p class="mb-0">Your account is pending verification. You'll be able to apply for jobs once an administrator verifies your account.</p>
            {% if not user.id_document %}
            <hr>
            <p class="mb-0">Please upload your identification document to speed up verification.</p>
            {% endif %}
        {% elif user.verification_status == 'R' %}
            <p class="mb-0">Your account verification was rejected. Please contact support for more information.</p>
        {% endif %}
    </div>
    {% endif %}
    
    <div class="row g-4 mb-5">
        <div class="col-md-3">
            <div class="card bg-primary text-white h-100">
                <div class="card-body">
                    <h5 class="card-title"><i class="bi bi-file-earmark-text"></i> Total Applications</h5>
                    <h2 class="display-4">{{ total_applications }}</h2>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card bg-warning text-white h-100">
                <div class="card-body">
                    <h5 class="card-title"><i class="bi bi-hourglass-split"></i> Pending</h5>
                    <h2 class="display-4">{{ pending }}</h2>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card bg-success text-white h-100">
                <div class="card-body">
                    <h5 class="card-title"><i class="bi bi-check-circle"></i> Accepted</h5>
                    <h2 class="display-4">{{ accepted }}</h2>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card bg-danger text-white h-100">
                <div class="card-body">
                    <h5 class="card-title"><i class="bi bi-x-circle"></i> Rejected</h5>
                    <h2 class="display-4">{{ rejected }}</h2>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row g-4 mb-4">
        <div class="col-md-12">
            <div class="d-flex justify-content-between align-items-center">
                <h3>My Applications</h3>
                <a href="{% url 'jobs:job_list' %}" class="btn btn-primary">
                    <i class="bi bi-search"></i> Browse Jobs
                </a>
            </div>
        </div>
    </div>
    
    {% if applications %}
    <div class="card mb-5">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Job Title</th>
                            <th>Company</th>
                            <th>Applied</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for app in applications %}
                        <tr>
                            <td><a href="{% url 'jobs:job_detail' app.job.pk %}">{{ app.job.title }}</a></td>
                            <td>{{ app.job.company.username }}</td>
                            <td>{{ app.date_applied|date:"M d, Y" }}</td>
                            <td>
                                {% if app.status == 'P' %}
                                <span class="badge bg-warning">Pending</span>
                                {% elif app.status == 'A' %}
                                <span class="badge bg-success">Accepted</span>
                                {% else %}
                                <span class="badge bg-danger">Rejected</span>
                                {% endif %}
                            </td>
                            <td>
                                <a href="{% url 'jobs:job_detail' app.job.pk %}" class="btn btn-sm btn-outline-primary">View Job</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="text-center mb-5">
        <a href="{% url 'jobs:my_applications' %}" class="btn btn-outline-primary">View All Applications</a>
    </div>
    {% else %}
    <div class="alert alert-info mb-5">
        <i class="bi bi-info-circle"></i> You haven't applied to any jobs yet. <a href="{% url 'jobs:job_list' %}">Browse available jobs</a> and start applying!
    </div>
    {% endif %}
    
    <div class="row g-4">
        <div class="col-md-12">
            <h3>Recent Job Opportunities</h3>
        </div>
        {% if recent_jobs %}
        {% for job in recent_jobs %}
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">{{ job.title }}</h5>
                    <p class="text-muted mb-2">
                        <span class="badge bg-secondary">{{ job.get_category_display }}</span>
                        <span class="badge bg-info">{{ job.get_job_type_display }}</span>
                    </p>
                    <p class="mb-2"><i class="bi bi-building"></i> {{ job.company.username }}</p>
                    <p class="mb-2"><i class="bi bi-geo-alt"></i> {{ job.location }}</p>
                    {% if job.salary %}
                    <p class="mb-2"><i class="bi bi-cash"></i> {{ job.currency }} {{ job.salary|floatformat:0 }}</p>
                    {% endif %}
                    <p class="mb-3"><i class="bi bi-calendar"></i> Deadline: {{ job.deadline|date:"M d, Y" }}</p>
                    <a href="{% url 'jobs:job_detail' job.pk %}" class="btn btn-sm btn-primary">View Details</a>
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="col-md-12">
            <div class="alert alert-secondary">No recent jobs available.</div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
